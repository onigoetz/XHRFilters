<html>
<head>
    <title>Ajax Promises Experiment</title>
</head>
<body>

<button id="request">Make request</button>

<div id="modalContainer"></div>


<script src="jquery-1.11.3.js"></script>
<script src="dist/XHRMiddleware.min.js"></script>
<script>

    function modalValidate() {
        return jQuery.Deferred(function (deferred) {

            var modal = $("<div style='border:1px solid black;'><input><button>OK</button></div>").appendTo("#modalContainer");
            var input = modal.find("input");

            modal.find("button").click(function () {
                if (input.val() == "no") {
                    deferred.reject();
                } else {
                    deferred.resolve();
                }

                modal.remove();
            });
        });
    }

    $.ajaxRegisterMiddleware({
        before: function (options) {
            console.log('Middleware1, Before, Time:', Date.now(), arguments);
        },
        //public Function( Anything data, String textStatus, jqXHR jqXHR ) success;
        done: function (jqXHR, data, options, deferredHelpers, next) {
            console.log('Middleware1, Done, Time:', Date.now(), arguments);
            next();
        },
        //public Function( jqXHR jqXHR, String textStatus, String errorThrown ) error;
        fail: function (jqXHR, error, options, deferredHelpers, next) {
            console.log('Middleware1, Fail, Time:', Date.now(), arguments);
            next();
        }
    });

    $.ajaxRegisterMiddleware({
        before: function (options) {
            console.log('Middleware2, Before, Time:', Date.now(), arguments);
        },
        //public Function( Anything data, String textStatus, jqXHR jqXHR ) success;
        done: function (jqXHR, data, options, deferredHelpers, next) {
            console.log('Middleware2, Done, Time:', Date.now(), arguments);
            next();
        },
        //public Function( jqXHR jqXHR, String textStatus, String errorThrown ) error;
        fail: function (jqXHR, error, options, deferredHelpers, next) {
            console.log('Middleware2, Fail, Time:', Date.now(), arguments);
            next();
        }
    });

    /*modalValidate().then(function () {
     console.log("Modal Worked");
     }).fail(function () {
     console.log("Modal Failed");
     });*/

    /**/

    function run() {
        return $.ajax("server.php", {
            success: function () {
                console.log("option success!");
            }, complete: function (xhr) {
                console.log("option complete!", xhr);
            }
        }).done(function () {
            console.log("promise then!");
        }).fail(function () {
            console.log("promise fail!");
        })
    }

    $("#request").click(run);
</script>


</body>
</html>
